    {% extends 'dashlayout.html' %}
{% load static %}
{% block content %}

      <div class="container-fluid">

                <div class="page-title-head d-flex align-items-center">
                    <div class="flex-grow-1">
                        <h4 class="fs-xl fw-bold m-0">Admin Dashboard</h4>
                    </div>

                    <div class="text-end">
                        <ol class="breadcrumb m-0 py-0">


                            <li class="breadcrumb-item active">Dashboard</li>
                        </ol>
                    </div>
                </div>


                <div class="row row-cols-xxl-4 row-cols-md-2 row-cols-1 g-3 align-items-center">
                    <div class="col">
                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div class="avatar avatar-lg flex-shrink-0">
                                        <span class="avatar-title bg-info-subtle text-info rounded fs-24">
                                            <i class="ti ti-clipboard-list"></i>
                                        </span>
                                    </div>
                                    <div class="text-end">
                                        <h4 class="mb-0">{{coursescount}}</h4>
                                        <p class="mb-0 text-muted">Active Courses</p>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="d-flex justify-content-between mb-1">
                                        <span class="text-muted fs-xs fw-semibold">PROGRESS</span>
                                        <span class="text-muted">100%</span>
                                    </div>
                                    <div class="progress" style="height: 6px;">
                                        <div class="progress-bar bg-info" style="width: 100%;"></div>
                                    </div>
                                </div>
                            </div> <!-- end card-body-->
                        </div> <!-- end card-->
                    </div> <!-- end col-->

<!--                    <div class="col">-->
<!--                        <div class="card">-->
<!--                            <div class="card-body">-->
<!--                                <div class="d-flex justify-content-between align-items-start">-->
<!--                                    <div class="avatar avatar-lg flex-shrink-0">-->
<!--                                        <span class="avatar-title bg-success-subtle text-success rounded fs-24">-->
<!--                                            <i class="ti ti-checklist"></i>-->
<!--                                        </span>-->
<!--                                    </div>-->
<!--                                    <div class="text-end">-->
<!--                                        <h4 class="mb-0">124</h4>-->
<!--                                        <p class="mb-0 text-muted">Tasks Completed</p>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                                <div class="mt-4">-->
<!--                                    <div class="d-flex justify-content-between mb-1">-->
<!--                                        <span class="text-muted fs-xs fw-semibold">TARGET</span>-->
<!--                                        <span class="text-muted">88%</span>-->
<!--                                    </div>-->
<!--                                    <div class="progress" style="height: 6px;">-->
<!--                                        <div class="progress-bar bg-success" style="width: 88%;"></div>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div> &lt;!&ndash; end card-body&ndash;&gt;-->
<!--                        </div> &lt;!&ndash; end card&ndash;&gt;-->
<!--                    </div> &lt;!&ndash; end col&ndash;&gt;-->

<!--                    <div class="col">-->
<!--                        <div class="card">-->
<!--                            <div class="card-body">-->
<!--                                <div class="d-flex justify-content-between align-items-start">-->
<!--                                    <div class="avatar avatar-lg flex-shrink-0">-->
<!--                                        <span class="avatar-title bg-warning-subtle text-warning rounded fs-24">-->
<!--                                            <i class="ti ti-clock-hour-4"></i>-->
<!--                                        </span>-->
<!--                                    </div>-->
<!--                                    <div class="text-end">-->
<!--                                        <h4 class="mb-0">16</h4>-->
<!--                                        <p class="mb-0 text-muted">Pending Tasks</p>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                                <div class="mt-4">-->
<!--                                    <div class="d-flex justify-content-between mb-1">-->
<!--                                        <span class="text-muted fs-xs fw-semibold">DEADLINES</span>-->
<!--                                        <span class="text-muted">42%</span>-->
<!--                                    </div>-->
<!--                                    <div class="progress" style="height: 6px;">-->
<!--                                        <div class="progress-bar bg-warning" style="width: 42%;"></div>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div> &lt;!&ndash; end card-body&ndash;&gt;-->
<!--                        </div> &lt;!&ndash; end card&ndash;&gt;-->
<!--                    </div> &lt;!&ndash; end col&ndash;&gt;-->

                    <div class="col">
                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div class="avatar avatar-lg flex-shrink-0">
                                        <span class="avatar-title bg-danger-subtle text-danger rounded fs-24">
                                            <i class="ti ti-user-cog"></i>
                                        </span>
                                    </div>
                                    <div class="text-end">
                                        <h4 class="mb-0">{{userslistcount}}</h4>
                                        <p class="mb-0 text-muted">Users</p>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="d-flex justify-content-between mb-1">
                                        <span class="text-muted fs-xs fw-semibold"></span>
                                        <span class="text-muted">100%</span>
                                    </div>
                                    <div class="progress" style="height: 6px;">
                                        <div class="progress-bar bg-danger" style="width: 100%;"></div>
                                    </div>
                                </div>
                            </div> <!-- end card-body-->
                        </div> <!-- end card-->
                    </div> <!-- end col-->
                </div>
                <!-- end row-->

                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body p-0">
                                <div class="row g-0">
                                    <div class="col-xxl-3 col-xl-6 order-xl-1 order-xxl-0">
                                        <div class="p-3 border-end border-dashed">
                                            <h4 class="card-title mb-0">Total Sales</h4>
                                            <p class="text-muted fs-xs">
                                                You have {{awaiting_confirmation}} pending orders awaiting Confirmation.
                                            </p>

                                            <div class="row mt-4">
                                                <div class="col-lg-12">
                                                    <div style="height: 300px;">
                                                        <canvas id="multi-pie-chart"></canvas>
                                                    </div>
                                                </div>
                                            </div>
                                        </div> <!-- end .p-4-->
                                        <hr class="d-xxl-none border-light m-0">
                                    </div> <!-- end col-->
                                    <div class="col-xxl-9 order-xl-3 order-xxl-1">
                                        <div class="px-4 py-3">
                                            <div class="d-flex justify-content-between mb-3">
                                                <h4 class="card-title">Sales Analytics</h4>
                                                <a href="#!" class="link-reset text-decoration-underline fw-semibold link-offset-3">View Reports <i class="ti ti-arrow-right"></i></a>
                                            </div>

                                            <div dir="ltr">
                                                <div class="mt-3" style="height: 330px;">
                                                    <canvas id="sales-analytics-chart"></canvas>
                                                </div>
                                            </div>
                                        </div> <!-- end .px-4-->
                                    </div> <!-- end col-->

                                </div> <!-- end row-->
                            </div> <!-- end card-body-->
                        </div> <!-- end card-->
                    </div> <!-- end col-->
                </div> <!-- end row-->

                <div class="row">

    <div class="col-xl-4">
  <div class="card">
    <div class="card-header">
      <h4 class="card-title">Contact Messages</h4>
    </div>

    <div class="card-body py-0" style="height: 380px;" data-simplebar>

      <div class="list-group list-group-flush">

        <a href="#" class="list-group-item list-group-item-action py-3">
          <div class="d-flex justify-content-between">
            <h6 class="mb-1 fw-semibold">Course Access Issue</h6>
            <small class="text-muted">09:45 AM</small>
          </div>
          <p class="mb-1 text-muted fs-sm">Unable to access purchased course</p>
          <span class="badge bg-warning-subtle text-warning fs-xxs">Support</span>
        </a>

        <a href="#" class="list-group-item list-group-item-action py-3">
          <div class="d-flex justify-content-between">
            <h6 class="mb-1 fw-semibold">Payment Confirmation</h6>
            <small class="text-muted">08:20 AM</small>
          </div>
          <p class="mb-1 text-muted fs-sm">Payment deducted but course locked</p>
          <span class="badge bg-info-subtle text-info fs-xxs">Payments</span>
        </a>

        <a href="#" class="list-group-item list-group-item-action py-3">
          <div class="d-flex justify-content-between">
            <h6 class="mb-1 fw-semibold">Course Inquiry</h6>
            <small class="text-muted">Yesterday</small>
          </div>
          <p class="mb-1 text-muted fs-sm">Is this course beginner friendly?</p>
          <span class="badge bg-primary-subtle text-primary fs-xxs">General</span>
        </a>

        <a href="#" class="list-group-item list-group-item-action py-3">
          <div class="d-flex justify-content-between">
            <h6 class="mb-1 fw-semibold">Refund Request</h6>
            <small class="text-muted">Yesterday</small>
          </div>
          <p class="mb-1 text-muted fs-sm">Requesting refund for Course A</p>
          <span class="badge bg-danger-subtle text-danger fs-xxs">Refund</span>
        </a>

      </div>

    </div>

    <div class="card-footer text-center">
      <a href="#" class="fw-semibold text-decoration-underline">
        View all messages
      </a>
    </div>
  </div>
</div>

    <div class="col-xxl-4 col-lg-6">
  <div class="card">
    <div class="card-header">
      <h5 class="card-title">Purchases Overview</h5>
    </div>

    <div class="card-body">

      <div class="row mb-3">
        <div class="col">
<h3 class="fw-bold">{{ purchase_count|default:0 }}</h3>

          <p class="text-muted fw-semibold">Total Purchases</p>
        </div>
        <div class="col-auto">
          <ul class="list-unstyled mb-0 lh-lg">
<!--            <li><i class="ti ti-dot text-primary"></i> Development</li>-->
<!--            <li><i class="ti ti-dot text-success"></i> Design</li>-->
<!--            <li><i class="ti ti-dot text-info"></i> Business</li>-->
          </ul>
        </div>
      </div>

      <div class="progress mb-3" style="height: 10px;">
        <div class="progress-bar bg-primary" style="width: 45%"></div>
        <div class="progress-bar bg-success" style="width: 30%"></div>
        <div class="progress-bar bg-info" style="width: 25%"></div>
      </div>

      <div class="table-responsive">
        <table class="table table-sm table-custom table-hover mb-0">
          <thead class="bg-light bg-opacity-25 thead-sm">
            <tr class="fs-xxs text-uppercase">
              <th>Course</th>
              <th class="text-end">Purchases</th>
              <th class="text-end">Last Purchase</th>
            </tr>
          </thead>
          <tbody>
          {%for a in purchases %}
            <tr>
              <td>{{a.title}}</td>
              <td class="text-end">{{a.purchase_count}}</td>
              <td class="text-end">-</td>
            </tr>
    {%endfor%}
          </tbody>
        </table>
      </div>

    </div>
  </div>
</div>


 <div class="col-xxl-4 col-lg-6">
  <div class="card">
    <div class="card-header">
      <h4 class="card-title">Top Courses by Views</h4>
    </div>

    <div class="card-body">

        {%for a in CourseView %}
      <div class="d-flex align-items-center mb-3">
        <h6 class="fw-medium mb-0">{{a.title}}</h6>
        <span class="ms-auto badge bg-success-subtle text-success fs-xxs">
        {{a.view_count}}
        </span>
      </div>
    {%endfor%}


      <div class="text-center mt-4">
        <a href="{% url 'admin_courses' %}"
           class="fw-semibold text-decoration-underline">
          View all courses
        </a>
      </div>

    </div>
  </div>
</div>



                </div> <!-- end row-->





            </div>
    <script src="{% static 'jays/chart.umd.js' %}"></script>
    <script>
  const projectedSales = {{ monthly_projection|safe }};
  const carttotal = {{ total_cart_items|safe }};
  const purchasecount = {{ purchase_count|safe }};
  const actualSales = {{ monthly_purchases|safe }};
</script>
<script>
    console.log(projectedSales);
/* ================= COMMON ================= */
const bodyFont = getComputedStyle(document.body).fontFamily.trim();

/* ================= MULTI PIE (OPTIONAL / STATIC) ================= */
if (document.querySelector("#multi-pie-chart")) {
  new CustomChartJs({
    selector: "#multi-pie-chart",
    options: () => ({
      type: "doughnut",
      data: {
        labels: [
          "Users Cart Items Count",
          "Users Purchase Count",
        ],
        datasets: [{
          label: "Revenue Split",
          data: [carttotal, purchasecount],
          backgroundColor: [
            ins("chart-primary"),
            ins("chart-dark"),
            ins("chart-gray")
          ],
          cutout: "30%",
          radius: "85%"
        }]
      },
      options: {
        plugins: {
          legend: {
            position: "bottom",
            labels: {
              font: { family: bodyFont },
              color: ins("secondary-color")
            }
          }
        }
      }
    })
  });
}

/* ================= SALES + PROJECTION ================= */
if (document.querySelector("#sales-analytics-chart")) {

  const months = [
    "Jan","Feb","Mar","Apr","May","Jun",
    "Jul","Aug","Sep","Oct","Nov","Dec"
  ];

  /* Dummy sales data (bars) */
  const dummySales = [
    1200, 1500, 1800, 1600, 2000, 2200,
    2100, 2300, 2400, 2600, 2800, 3000
  ];

  new CustomChartJs({
    selector: "#sales-analytics-chart",
    options: () => ({
      data: {
        labels: months,
        datasets: [
          /* BAR — SALES */
          {
            type: "bar",
            label: "Actual Sales",
            data: actualSales,
            backgroundColor: ins("chart-primary"),
            barThickness: 24,
            borderRadius: 6
          },

          /* LINE — PROJECTED REVENUE */
          {
            type: "line",
            label: "Projected Revenue",
            data: projectedSales,
            borderColor: ins("chart-dark"),
            backgroundColor: ins("chart-dark-rgb", 0.15),
            borderWidth: 3,
            pointRadius: 4,
            pointHoverRadius: 6,
            tension: 0.4,
            fill: false
          }
        ]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            labels: {
              font: { family: bodyFont },
              color: ins("secondary-color")
            }
          },
          tooltip: {
            callbacks: {
              label: ctx =>
                `${ctx.dataset.label}: ₦${ctx.parsed.y.toLocaleString()}`
            }
          }
        },
        scales: {
          x: {
            grid: { display: false }
          },
          y: {
            beginAtZero: true,
            ticks: {
              callback: value => `₦${value.toLocaleString()}`
            }
          }
        }
      }
    })
  });
}
</script>





    {% endblock %}