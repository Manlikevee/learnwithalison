{% extends 'dashlayout.html' %}
{% load static %}
{% load humanize %}
{% block content %}

<style>
  .course-desc {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    min-height: 40px;
  }
</style>

<div class="container-fluid">

  <!-- PAGE TITLE -->
  <div class="page-title-head d-flex align-items-center">
    <div class="flex-grow-1">
      <h4 class="fs-xl fw-bold m-0">All Courses</h4>
    </div>

    <div class="d-flex gap-2 align-items-center">
      <a href="{% url 'admin_course_create' %}" class="btn btn-primary btn-sm">
        <i class="ti ti-plus"></i> Add New Course
      </a>

      <ol class="breadcrumb m-0 py-0">
        <li class="breadcrumb-item"><a href="#">Dashboard</a></li>
        <li class="breadcrumb-item active">Courses</li>
      </ol>
    </div>
  </div>

  <!-- SEARCH -->
  <div class="row mt-3">
    <div class="col-md-6">
      <div class="app-search">
        <input
          type="search"
          id="courseSearch"
          class="form-control"
          placeholder="Search courses..."
        >
        <i data-lucide="search" class="app-search-icon text-muted"></i>
      </div>
    </div>
  </div>

  <!-- COURSES GRID -->
  <div class="row row-cols-xxl-4 row-cols-lg-3 row-cols-md-2 row-cols-1 g-3 mt-3">

    {% for course in courses %}
    <div class="col course-item"
         data-search="{{ course.title|lower }} {{ course.category.name|lower }} {{ course.short_description|lower }}">

      <div class="card h-100">

        <!-- THUMBNAIL -->
        {% if course.thumbnail %}
          <img src="{{ course.thumbnail.url }}"
               class="card-img-top"
               style="height:160px; object-fit:cover;"
               alt="{{ course.title }}">
        {% else %}
          <div class="bg-light d-flex align-items-center justify-content-center"
               style="height:160px;">
            <i class="ti ti-photo text-muted fs-1"></i>
          </div>
        {% endif %}

        <div class="card-body d-flex flex-column">

          <!-- HEADER -->
          <div class="d-flex justify-content-between align-items-start">
            <span class="badge bg-primary-subtle text-primary fs-xxs p-2">
              {{ course.category.name }}
            </span>

            <div class="dropdown">
              <a href="#" class="text-muted" data-bs-toggle="dropdown">
                <i class="ti ti-dots-vertical"></i>
              </a>
              <div class="dropdown-menu dropdown-menu-end">
                <a href="{% url 'admin_course_edit' course.id %}" class="dropdown-item">
                  <i class="ti ti-edit me-1"></i> Edit
                </a>
<a href="{% url 'course_detail' course.id %}" class="dropdown-item">
  <i class="ti ti-eye me-1"></i> View Course
</a>
                <a href="{% url 'admin_course_delete' course.id %}"
                   class="dropdown-item text-danger"
                   onclick="return confirm('Delete this course?');">
                  <i class="ti ti-trash me-1"></i> Delete
                </a>
              </div>
            </div>
          </div>

          <!-- CONTENT -->
          <h5 class="fw-semibold mt-2">{{ course.title }}</h5>

          <p class="text-muted fs-sm course-desc flex-grow-1">
            {{ course.short_description|default:"No description available" }}
          </p>

          <!-- FOOTER -->
          <div class="d-flex justify-content-between align-items-center mt-2">
            <h6 class="mb-0 fw-bold">
              {% if course.price_type == 'free' %}
                Free
              {% else %}
                ${{ course.price|intcomma }}
              {% endif %}
            </h6>

            <span class="badge
              {% if course.status == 'published' %}
                bg-success-subtle text-success
              {% else %}
                bg-warning-subtle text-warning
              {% endif %}
              fs-xxs">
              {{ course.status|title }}
            </span>
          </div>

        </div>
      </div>
    </div>
    {% empty %}
      <div class="col-12">
        <div class="alert alert-light text-center">
          No courses available yet.
        </div>
      </div>
    {% endfor %}

  </div>

</div>

<!-- SEARCH SCRIPT -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const searchInput = document.getElementById("courseSearch");
    const courseItems = document.querySelectorAll(".course-item");

    searchInput.addEventListener("keyup", function () {
      const query = this.value.toLowerCase().trim();

      courseItems.forEach(item => {
        const text = item.dataset.search;
        item.style.display = text.includes(query) ? "" : "none";
      });
    });
  });
</script>

{% endblock %}
